# 랭킹 시스템 개발 최종 진행 상황

진행사항을 확인 바랍니다

## ✅ 완료된 작업 (체크리스트)

### 1. 분석 및 계획
- [x] 현재 시스템 분석 완료
- [x] 개선 계획 수립
- [x] 구현 우선순위 설정

### 2. 엔티티 구현
- [x] `UserRanking` 엔티티 생성
    - [x] User와의 1:1 매핑
    - [x] 필수 필드 추가
    - [x] 기본값 설정 (`@PrePersist`를 통해 통합)
    - [x] 인덱스 설정
    - [x] `@PrePersist` 및 `@PreUpdate` 콜백 메서드 통합 및 분리 (오류 해결)
- [x] `RankingHistory` 엔티티 생성
    - [x] UserRanking과의 N:1 매핑
    - [x] 기간별 랭킹 기록 기능
    - [x] 필수 필드 추가

### 3. DTO 구현 및 구조 개선
- [x] `RankingRequest` DTO 생성
- [x] `RankingResponse` DTO 생성 및 리팩토링 (추상 클래스 -> 일반 클래스, `@SuperBuilder` -> `@Builder`, 필드 타입 및 final 제거)
- [x] `SeasonRankingResponse` DTO 생성 및 리팩토링 (부모 상속 제거, `@SuperBuilder` -> `@Builder`, 필드 직접 포함)
- [x] `PeriodRankingResponse` DTO 생성 및 리팩토링 (부모 상속 제거, `@SuperBuilder` -> `@Builder`, 필드 직접 포함)
- [x] `RankingStatsResponse` DTO 생성
- [x] `RankingHistoryResponse` DTO 생성
- [x] `RankingNotificationResponse` DTO 생성 (빌더 패턴 적용, 필수 필드)
- [x] `RankingRewardResponse` DTO 생성 (필드 정의 및 빌더 패턴 적용)
- [x] `RankingAchievementResponse` DTO 생성 (필드 정의 및 빌더 패턴 적용)
- [x] 불필요한 `/dto` 경로의 DTO 파일들 삭제 및 `/dto/ranking`으로 재배치

### 4. Repository 구현 및 최적화
- [x] `UserRankingRepository` 구현 및 최적화 (CRUD, 커스텀 쿼리, 정렬/필터링, 중복 메서드 제거, 트랜잭션 최적화)
- [x] `RankingHistoryRepository` 구현 및 최적화 (기간별/시즌별 조회, 통계 조회, 쿼리 최적화)

### 5. Service 계층 구현 및 리팩토링
- [x] `RankingService` 구현 및 리팩토링
    - [x] 랭킹 계산 및 업데이트 로직 (주로 `RankingScoreService`와 연동)
    - [x] 보상 지급 로직 (주로 `RankingRewardService`와 연동)
    - [x] `getCurrentUserUuid()` 메서드에 Spring Security를 활용한 동적 사용자 UUID 가져오기 로직 적용
    - [x] 랭킹 조회, 통계, 히스토리 조회 메서드 구현 및 DTO 변환 로직 적용
- [x] `RankingScoreService` 구현 및 리팩토링 (점수 계산, 스트릭 업데이트, 트랜잭션 최적화, 중복 로직 통합)
- [x] `RankingRewardService` 구현 및 리팩토링 (보상 획득, 시즌 보상, 기간별/스트릭 보상 로직, 트랜잭션 최적화)
- [x] `RankingNotificationService` 구현 및 리팩토링 (알림 조회, 랭킹 변동 알림, 스트릭 알림 생성 로직)

### 6. Controller 계층 구현
- [x] `RankingController` 구현 (랭킹 조회, 통계, 히스토리, 보상, 알림 API 엔드포인트)
- [x] `RankingHistoryController`는 별도 구현 없이 `RankingController`에 통합됨을 확인

### 7. 유틸리티 및 설정
- [x] `RankingValidator` 클래스 구현 (랭킹 데이터 유효성 검사)
- [x] `RankingConstants` 클래스 구현 (랭킹 시스템 상수 정의)
- [x] `RankingException` 및 `RankingNotFoundException` 등 커스텀 예외 정의
- [x] `Mockup.sql` 파일의 `meal_logs` INSERT 쿼리 수정 (null value 오류 해결)

## ⏳ 남은 사항 (진행 중이거나 마무리 필요)

- [ ] **테스트 코드 작성**:
    - [ ] Service 계층에 대한 단위 테스트 (모든 랭킹 관련 서비스 포함)
    - [ ] Repository 계층에 대한 단위 테스트 (모든 랭킹 관련 리포지토리 포함)
    - [ ] Controller 계층 (API 엔드포인트)에 대한 통합 테스트
    - [ ] 데이터베이스 연동 테스트 (실제 DB 연결 및 CRUD 동작 확인)

## 🚀 앞으로 해야 할 사항

- [ ] **Spring Security 통합 완료**: `getCurrentUserUuid()` 메서드가 실제 애플리케이션의 인증 플로우(JWT 토큰 파싱, `UserDetailsService` 구현 등)와 완벽하게 연동되도록 구현 및 테스트.
- [ ] **배치 처리 또는 스케줄링**: 주기적인 랭킹 업데이트 (`updateRankings` 등) 및 랭킹 히스토리 기록을 위한 배치 작업 또는 스케줄링 구현.
- [ ] **성능 최적화**: 대규모 사용자 환경을 고려한 쿼리 최적화 및 캐싱 전략 (Redis 등) 적용 검토.
- [ ] **예외 처리 상세화**: 각 API 엔드포인트 및 서비스 로직에서 발생할 수 있는 다양한 예외 상황에 대한 더욱 상세하고 사용자 친화적인 예외 처리 구현.
- [ ] **보안 강화**: 권한 부여(`@PreAuthorize`) 및 입력값 검증(`@Valid`) 등 Spring Security를 활용한 추가적인 보안 강화.
- [ ] **로깅(Logging)**: 랭킹 시스템의 주요 작업(랭킹 계산, 업데이트, 보상 지급 등)에 대한 상세 로깅 구현.
- [ ] **프론트엔드 연동**: 현재 구현된 백엔드 API를 프론트엔드(`apps/frontend-vite`)와 연동하여 실제 UI에서 랭킹 정보를 표시하고 조작할 수 있도록 구현.
- [ ] **문서화**: API 명세서(Swagger/OpenAPI) 작성 및 기술 문서 업데이트. 