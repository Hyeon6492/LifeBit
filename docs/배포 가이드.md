# 🚀 LifeBit 도메인 연결 & 자동 배포 가이드

이 문서는 **가비아(또는 타사)에서 도메인 구매 → DNS 설정 → AWS 배포 자동화 → 도메인 연결 및 SSL 적용**까지의 전체 과정을 한 번에 안내합니다.

---

## 1️⃣ 도메인 구매 & DNS 설정

### 1. 도메인 구매
- 가비아, 카페24, AWS Route53 등 원하는 곳에서 도메인 구매

### 2. 네임서버/레코드 설정
- **가비아 기준**
  1. [가비아 도메인 관리](https://www.gabia.com/) 접속 → 내 도메인 선택
  2. **DNS 관리** 메뉴로 이동
  3. **A레코드(@, www)**를 AWS EC2 퍼블릭 IP로 설정
     - 예시:
       - `@` → `43.202.14.145`
       - `www` → `43.202.14.145`
  4. **네임서버는 기본값(가비아 NS) 유지**
- **타사도 동일**: 도메인 관리 → DNS 관리 → A레코드에 서버 IP 입력
- **Route53 사용 시**: 네임서버(NS)만 Route53에서 발급된 값으로 변경

> ⚡️ **TIP:** 네임서버를 잘못 건드렸다면, "기본 네임서버로 복구" 후 A레코드만 다시 저장하세요.

---

## 2️⃣ 배포 전 준비

### 1. 필수 도구 설치
- AWS CLI, Terraform, Ansible 설치 (아래 명령어 참고)
- 자세한 설치법은 기존 가이드 참고

### 2. 환경변수 파일 준비
```bash
cp .env.example .env
nano .env   # 필수 값 입력 (도메인, DB, JWT 등)
```

### 3. 도메인 DNS 전파 확인
- [dnschecker.org](https://dnschecker.org/#A/yourdomain.com)에서 A레코드가 전 세계적으로 잘 보이는지 확인
- 전파가 안 됐다면 10~30분 기다렸다가 진행

---

## 3️⃣ 자동 배포 실행

### 1. 배포 스크립트 실행
```bash
./aws-deploy.sh deploy
```
- 스크립트가 실행되면 **도메인명을 입력**하라는 안내가 나옵니다.
- 구매한 도메인(예: `jisub.store`)을 입력
- 이후 모든 과정(키페어 생성, 인프라 생성, Ansible 배포, Nginx/SSL 자동설정)이 자동으로 진행됩니다.

### 2. 배포 완료 후 안내 메시지
- 배포가 끝나면 아래와 같은 메시지가 출력됩니다:
```
--- 배포 완료 ---
애플리케이션은 https://[도메인] 에서 확인할 수 있습니다.
키페어 정보: lifebit-key-YYYYMMDD-HHMMSS
키 파일 경로: /home/user/.ssh/lifebit-key-YYYYMMDD-HHMMSS.pem
```

---

## 4️⃣ 배포 후 점검 & 서비스 확인

### 1. 도메인 접속
- 브라우저에서 `https://[도메인]` 접속
- **SSL(https) 자동 적용**
- 정상적으로 서비스 화면이 나오면 성공!

### 2. 문제 발생 시
- "Welcome to nginx!"만 보이면 → Nginx 설정/프록시 미적용 (엔서블 재배포 필요)
- SSL 인증서 오류 → DNS 전파/네임서버/A레코드/포트 개방 확인 후 certbot 재실행
- 접속 불가 → 보안그룹(80, 443), 서버 상태, 도커 컨테이너 상태 확인

---

## 5️⃣ 리소스 삭제(비용 절감)
```bash
./aws-deploy.sh destroy
```
- 모든 AWS 리소스, 키페어, 배포 정보 완전 삭제

---

## 6️⃣ 자주 묻는 질문(FAQ)

- **Q. 도메인 연결이 안 돼요!**
  - A. DNS 전파(최대 24시간), A레코드, 네임서버, 보안그룹, 서버 상태를 차례로 점검하세요.
- **Q. SSL 인증서가 안 떠요!**
  - A. DNS가 완전히 전파된 후 certbot이 자동으로 인증서를 발급합니다. 안 될 경우 certbot 수동 실행.
- **Q. "Welcome to nginx!"만 나와요!**
  - A. Nginx 설정이 서버에 적용되지 않은 상태입니다. Ansible로 재배포하거나, Nginx conf를 수동으로 복사 후 reload 하세요.
- **Q. 배포 후 서비스가 안 떠요!**
  - A. 도커 컨테이너 상태(`docker ps`), 로그(`docker-compose logs`), 포트 개방, DB 연결 등을 점검하세요.

---

## 7️⃣ 참고 링크
- [가비아 도메인 관리](https://www.gabia.com/)
- [DNS 전파 확인](https://dnschecker.org/)
- [Let's Encrypt SSL](https://letsencrypt.org/)
- [Nginx 공식 문서](https://nginx.org/en/docs/)

---

**이 가이드만 따라하면 누구나 도메인 연결부터 AWS 자동 배포, SSL까지 한 번에 끝낼 수 있습니다!**

궁금한 점은 언제든 문의하세요 😊 